<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>登录页面</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="images/7favicon.ico" />

    <!-- basic styles -->

    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="layer/layui/css/layui.css"  media="all" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->

    <!-- fonts -->

    <link rel="stylesheet" href="css/fonts.css" />

    <!-- ace styles -->

    <link rel="stylesheet" href="css/ace.min.css" />
    <link rel="stylesheet" href="css/ace-rtl.min.css" />

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

</head>

<body class="login-layout">
    <div class="main-container">
        <div class="main-content">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="login-container">
                        <div class="center">
                            <h1>
                                <i class="icon-leaf green"></i>
                                <span class="red">CC</span>
                                <span class="white">博园</span>
                            </h1>
                        </div>

                        <div class="space-6"></div>

                        <div class="position-relative">
                            <div id="login-box" class="login-box visible widget-box no-border">
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <h4 class="header blue lighter bigger">
                                            <i class="icon-coffee green"></i>
                                            登 录
                                        </h4>

                                        <div class="space-6"></div>


                                        <fieldset>
                                            <label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" id="user_name" class="form-control name" maxlength="15" placeholder="用户名" />
															<i class="icon-user"></i>
														</span>
                                            </label>

                                            <label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" id="password" class="form-control psw" maxlength="15" placeholder="密    码" />
															<i class="icon-lock"></i>
														</span>
                                            </label>

                                            <div class="space"></div>

                                            <div class="clearfix">
                                                <label class="inline">
                                                    <input type='checkbox' class="ace" name='VoteOption1' id="rmbUser" value=1>
                                                    <span class="lbl"> 记住密码</span>
                                                </label>

                                                <button type="button" class="submit width-35 pull-right btn btn-sm btn-primary"  onclick="saveUserInfo()" >
                                                    <i class="icon-key"></i>
                                                    登 录
                                                </button>
                                            </div>

                                            <div class="space-4"></div>
                                        </fieldset>


                                        <!-- <div class="social-or-login center">
                                            <span class="bigger-110">Or Login Using</span>
                                        </div>

                                        <div class="social-login center">
                                            <a class="btn btn-primary">
                                                <i class="icon-facebook"></i>
                                            </a>

                                            <a class="btn btn-info">
                                                <i class="icon-twitter"></i>
                                            </a>

                                            <a class="btn btn-danger">
                                                <i class="icon-google-plus"></i>
                                            </a>
                                        </div> -->
                                    </div><!-- /widget-main -->

                                    <div class="toolbar clearfix">
                                        <!-- <div>
                                            <a href="#" onclick="show_box('forgot-box'); return false;" class="forgot-password-link">
                                                <i class="icon-arrow-left"></i>
                                                忘记密码
                                            </a>
                                        </div> -->

                                        <div>
                                            还没有帐号？点击
                                            <a href="/reg" onclick="show_box('signup-box'); return false;" class="user-signup-link">
                                                注 册
                                                <i class="icon-arrow-right"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div><!-- /widget-body -->
                            </div><!-- /login-box -->

                            <!-- <div id="forgot-box" class="forgot-box widget-box no-border">
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <h4 class="header red lighter bigger">
                                            <i class="icon-key"></i>
                                            Retrieve Password
                                        </h4>

                                        <div class="space-6"></div>
                                        <p>
                                            Enter your email and to receive instructions
                                        </p>

                                        <form>
                                            <fieldset>
                                                <label class="block clearfix">
                                                    <span class="block input-icon input-icon-right">
                                                        <input type="email" class="form-control" placeholder="Email" />
                                                        <i class="icon-envelope"></i>
                                                    </span>
                                                </label>

                                                <div class="clearfix">
                                                    <button type="button" class="width-35 pull-right btn btn-sm btn-danger">
                                                        <i class="icon-lightbulb"></i>
                                                        Send Me!
                                                    </button>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>/widget-main

                                </div>/widget-body
                            </div> --><!-- /forgot-box -->


                        </div><!-- /position-relative -->
                    </div>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div>
    </div><!-- /.main-container -->

<!-- basic scripts -->

<!--[if !IE]> -->

<script src="js/jquery.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
<script src="js/jquery.cookie.js"></script>
<script src="layer/layer.js"></script>
<script src="layer/layui/layui.js"></script>
<script>
    if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
    //初始化页面时验证是否记住了密码
    $(document).ready(function() {
        if ($.cookie("rmbUser") == "true") {
            $("#rmbUser").attr("checked", true);
            $("#user_name").val($.cookie("userName"));
            $("#password").val($.cookie("passWord"));
        }
    });
    function saveUserInfo() {
        if ($("#rmbUser").is(':checked')) {
            var userName = $("#user_name").val();
            var passWord = $("#password").val();
            $.cookie("rmbUser", "true", {expires: 7}); // 存储一个带7天期限的 cookie
            $.cookie("userName", userName, {expires: 7}); // 存储一个带7天期限的 cookie
            $.cookie("passWord", passWord, {expires: 7}); // 存储一个带7天期限的 cookie
        }
        else {
            $.cookie("rmbUser", "false", {expires: -1});        // 删除 cookie
            $.cookie("userName", '', {expires: -1});
            $.cookie("passWord", '', {expires: -1});
        }
    }
    //提交后台
    $('.submit').click(function () {
        var regex = new RegExp(/^[0-9a-zA_Z]+$/);///^[0-9a-zA-Z]{8}$/ /^([a-z]|[A-Z]|[0-9]){8}$/
        var regex1 = new RegExp(/^[a-zA-Z0-9\u4e00-\u9fa5]+$/);
        var $name = $('.name').val();
        var $psw = $('.psw').val();
        if($name.replace(/^ +| +$/g,'')=='') {
            layer.msg('用户名不能为空', {
                icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                time: 1500
            });
            return;
        }else if(!regex1.test($name)){
            layer.msg('用户名格式错误(只能为中文、数字和字母)', {
                icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                time: 1500
            });
            return;
        }else if($psw.replace(/^ +| +$/g,'')==''){
            layer.msg('密码不能为空',{
                icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                time:1500
            });
            return;
        }else if(!regex.test($psw)){
            layer.msg('密码格式错误(只能输入字母和数字)',{
                icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                time:1500
            });
            return;
        }else{
            $.ajax({
                url: '/login',
                type: 'post',
                dataTpye: 'json',
                data: {
                    name: $('.name').val(),
                    password: $('.psw').val()
                },
                success: function (data) {
                    if(data.err){
                        layer.msg('用户名不存在',{
                            icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                            time:1500
                        });
                        return;
                    }
                    if(data.erro){
                        layer.msg('密码错误',{
                            icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                            time:1500
                        });
                        return;
                    }
                    layer.msg('登录成功',{
                        icon: 6, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                        time:1000
                    });
                    setTimeout(function () {
                        if(data.admin){
                            window.location.href = '/admin';
                        }else if(data.useradmin){
                            window.location.href = '/useradmin';
                        }else{
                            window.location.href = '/';
                        }
                    },1000);
                },
                error: function (data) {
                    // 返回的值不是规定的 dataType  类型的话，那么就会返回到 error 这个函数当中来
                    layer.msg('错误',{
                        icon: 2, //1，绿勾  2，红叉  3，黄问号  4，灰色锁头  5，红色委屈脸  6，绿色笑脸 7，黄色感叹号
                        time:1500
                    });
                }
            });
        }
    });

</script>


</body>
</html>
